<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
        <title>Document</title>
    </head>
    <body>
        <form action = "{{url_for('report')}}" method=post>
            {{form.hidden_tag()}}
            {{ form.csrf_token }}

            {{form.submit(class = "form-control btn btn-primary")}}
            
            <br>
            <br>

            Select a Table to Query:
            {{ form.tables(class = "form-select") }}

            <br>

            Select a Column to Filter by:
            {{ form.columns(class = "form-select") }}

            <br>
            
            Select a Column Value to by:
            {{ form.values(class = "form-select") }}
            
            <br>
            
            Select Downloadable Format:
            {{ form.formats(class = "form-select") }}
            
            <br>

            {{form.query(class = "form-control btn btn-primary")}}
            <br>
            
            <!-- <input type='submit' name='action' value='Generate PDF'>
            <br>
            <input type='submit' name='action' value='Generate JSON'>
            <br>
            <input type='submit' name='action' value='Generate CSV'> -->
        </form> 

        <script>
            let table_select = document.getElementById("tables");
            let column_select = document.getElementById('columns');
            let value_select = document.getElementById('values');

            table_select.onchange = function() {
                table = table_select.value;

                fetch( '/report/' + table ).then(function(response) {
                    response.json().then(function(data) {
                        let optionHTML = '';
                        
                        var inc = 1;
                        for (let item of data.columns) {
                            if (inc == 1) {
                                var column = item.name;
                            }
                            inc += 1;
                            optionHTML += '<option value="' + item.id + '">' + item.name + '</option>';
                        }
                        column_select.innerHTML = optionHTML;
                        
                        update_values(table, column);

                    });
                }); 
            }

            column_select.onchange = function() {
                table = table_select.value;
                column = column_select.value;

                update_values(table, column);
            }

            function update_values(table, column) {
                fetch( '/report/' + table + '/' + column ).then(function(response) {
                    response.json().then(function(data) {
                        let optionHTML = '';
                        for (let item of data.values) {
                            optionHTML += '<option value="' + item.id + '">' + item.name + '</option>';
                        }
                        value_select.innerHTML = optionHTML;
                    });
                });
            }
        </script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    </body>
</html>